import{i as l,_ as G,k as P,o as M,l as T,m as J,n as D,O as g,r as Y,p as H,q as K,t as W,b as j,c as N,e as B,j as p,u as Q}from"./index-9574e8c1.js";function V(e){return l(e==null?void 0:e.lift)}function O(e){return function(r){if(V(r))return r.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function C(e,r,t,n,o){return new X(e,r,t,n,o)}var X=function(e){G(r,e);function r(t,n,o,a,i,c){var s=e.call(this,t)||this;return s.onFinalize=i,s.shouldUnsubscribe=c,s._next=n?function(d){try{n(d)}catch(u){t.error(u)}}:e.prototype._next,s._error=a?function(d){try{a(d)}catch(u){t.error(u)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=o?function(){try{o()}catch(d){t.error(d)}finally{this.unsubscribe()}}:e.prototype._complete,s}return r.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},r}(P),R=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Z(e){return l(e==null?void 0:e.then)}function ee(e){return l(e[M])}function re(e){return Symbol.asyncIterator&&l(e==null?void 0:e[Symbol.asyncIterator])}function te(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ne(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ae=ne();function oe(e){return l(e==null?void 0:e[ae])}function se(e){return T(this,arguments,function(){var t,n,o,a;return J(this,function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,D(t.read())];case 3:return n=i.sent(),o=n.value,a=n.done,a?[4,D(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,D(o)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function ce(e){return l(e==null?void 0:e.getReader)}function E(e){if(e instanceof g)return e;if(e!=null){if(ee(e))return ie(e);if(R(e))return de(e);if(Z(e))return ue(e);if(re(e))return $(e);if(oe(e))return le(e);if(ce(e))return fe(e)}throw te(e)}function ie(e){return new g(function(r){var t=e[M]();if(l(t.subscribe))return t.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function de(e){return new g(function(r){for(var t=0;t<e.length&&!r.closed;t++)r.next(e[t]);r.complete()})}function ue(e){return new g(function(r){e.then(function(t){r.closed||(r.next(t),r.complete())},function(t){return r.error(t)}).then(null,Y)})}function le(e){return new g(function(r){var t,n;try{for(var o=H(e),a=o.next();!a.done;a=o.next()){var i=a.value;if(r.next(i),r.closed)return}}catch(c){t={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}r.complete()})}function $(e){return new g(function(r){ve(e,r).catch(function(t){return r.error(t)})})}function fe(e){return $(se(e))}function ve(e,r){var t,n,o,a;return K(this,void 0,void 0,function(){var i,c;return J(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),t=W(e),s.label=1;case 1:return[4,t.next()];case 2:if(n=s.sent(),!!n.done)return[3,4];if(i=n.value,r.next(i),r.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=s.sent(),o={error:c},[3,11];case 6:return s.trys.push([6,,9,10]),n&&!n.done&&(a=t.return)?[4,a.call(t)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}function me(e,r,t,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var a=r.schedule(function(){t(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(a),!o)return a}function k(e,r){return O(function(t,n){var o=0;t.subscribe(C(n,function(a){n.next(e.call(r,a,o++))}))})}var ge=Array.isArray;function he(e,r){return ge(r)?e.apply(void 0,j([],N(r))):e(r)}function pe(e){return k(function(r){return he(e,r)})}function ye(e,r,t,n,o,a,i,c){var s=[],d=0,u=0,m=!1,h=function(){m&&!s.length&&!d&&r.complete()},A=function(y){return d<n?I(y):s.push(y)},I=function(y){a&&r.next(y),d++;var x=!1;E(t(y,u++)).subscribe(C(r,function(b){o==null||o(b),a?A(b):r.next(b)},function(){x=!0},void 0,function(){if(x)try{d--;for(var b=function(){var w=s.shift();i?me(r,i,function(){return I(w)}):I(w)};s.length&&d<n;)b();h()}catch(w){r.error(w)}}))};return e.subscribe(C(r,A,function(){m=!0,h()})),function(){c==null||c()}}function q(e,r,t){return t===void 0&&(t=1/0),l(r)?q(function(n,o){return k(function(a,i){return r(n,a,o,i)})(E(e(n,o)))},t):(typeof r=="number"&&(t=r),O(function(n,o){return ye(n,o,e,t)}))}var be=["addListener","removeListener"],Se=["addEventListener","removeEventListener"],ke=["on","off"];function f(e,r,t,n){if(l(t)&&(n=t,t=void 0),n)return f(e,r,t).pipe(pe(n));var o=N(Ie(e)?Se.map(function(c){return function(s){return e[c](r,s,t)}}):we(e)?be.map(_(e,r)):Ce(e)?ke.map(_(e,r)):[],2),a=o[0],i=o[1];if(!a&&R(e))return q(function(c){return f(c,r,t)})(E(e));if(!a)throw new TypeError("Invalid event target");return new g(function(c){var s=function(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];return c.next(1<d.length?d:d[0])};return a(s),function(){return i(s)}})}function _(e,r){return function(t){return function(n){return e[t](r,n)}}}function we(e){return l(e.addListener)&&l(e.removeListener)}function Ce(e){return l(e.on)&&l(e.off)}function Ie(e){return l(e.addEventListener)&&l(e.removeEventListener)}function S(e,r,t){var n=l(e)||r||t?{next:e,error:r,complete:t}:e;return n?O(function(o,a){var i;(i=n.subscribe)===null||i===void 0||i.call(n);var c=!0;o.subscribe(C(a,function(s){var d;(d=n.next)===null||d===void 0||d.call(n,s),a.next(s)},function(){var s;c=!1,(s=n.complete)===null||s===void 0||s.call(n),a.complete()},function(s){var d;c=!1,(d=n.error)===null||d===void 0||d.call(n,s),a.error(s)},function(){var s,d;c&&((s=n.unsubscribe)===null||s===void 0||s.call(n)),(d=n.finalize)===null||d===void 0||d.call(n)}))}):B}var z=(e=>(e.Colorless="colorless",e.Darkness="darkness",e.Dragon="dragon",e.Fairy="fairy",e.Fighting="fighting",e.Fire="fire",e.Grass="grass",e.Lightning="lightning",e.Metal="metal",e.Psychic="psychic",e.Water="water",e))(z||{});const v="@espeon/deck",De=f(window,"DOMContentLoaded"),Ne=e=>{const r=localStorage.getItem(v);if(!(typeof r=="string"&&r.length!==0)){const u=new Map;u.set(e.id,{...e,count:1}),localStorage.setItem(v,JSON.stringify({cards:Array.from(u.entries())}));return}const n=JSON.parse(r),{cards:o}=n,a=new Map(o),i=a.get(e.id);if(!!!(i!=null&&i.id)){const u=a.set(e.id,{...e,count:1});localStorage.setItem(v,JSON.stringify({cards:Array.from(u.entries())}));return}const{count:s}=i,d=a.set(e.id,{...e,count:s+1});localStorage.setItem(v,JSON.stringify({cards:Array.from(d.entries())}))},Le=e=>{const r=localStorage.getItem(v);if(!(typeof r=="string"&&r.length!==0))return;const n=JSON.parse(r),{cards:o}=n,a=new Map(o),i=a.get(e.id);if(!!!(i!=null&&i.id))return;const{count:s}=i;if(s-1>0){const d=a.set(e.id,{...e,count:s-1});localStorage.setItem(v,JSON.stringify({cards:Array.from(d.entries())}));return}a.delete(e.id),localStorage.setItem(v,JSON.stringify({cards:Array.from(a.entries())}))},Oe=e=>{localStorage.setItem(v,JSON.stringify({cards:Array.from(e.entries())}))},U=()=>{const e=localStorage.getItem(v);if(!(typeof e=="string"&&e.length!==0))return new Map;const t=JSON.parse(e),{cards:n}=t;return new Map(n)},L=e=>{const{id:r,imageurl:t,name:n,types:o="",count:a}=e.dataset;return{id:r??"",imageURL:t??"",name:n??"",types:JSON.parse(o)??[],count:Number(a)}},Ee=({id:e,count:r})=>{var o;const t=document.querySelector(`[data-id="${e}"]`);if(!t)return;const n=r-1;if(n>0){const a=t.querySelector(".deck-card-counter");if(t.dataset.count=String(n),!a)return;a.textContent=String(n);return}(o=t==null?void 0:t.parentNode)==null||o.removeChild(t)},F=e=>{const r=document.querySelector(`[data-id="${e}"]`),t=L(r);Ee(t),Le(t)},Ae=({count:e,id:r,imageURL:t,name:n,types:o})=>{const a=(o==null?void 0:o[0])??z.Colorless,i=p({tagName:"div",attributes:{class:`deck-card ${a.toLowerCase()}`,draggable:"true","data-id":r,"data-name":n,"data-types":JSON.stringify(o),"data-imageurl":t,"data-count":String(e)}}),c=p({tagName:"button",attributes:{class:"deck-card-remove-btn","data-id":r,title:"remove card"}});c.onclick=()=>F(r);const s=p({tagName:"i",attributes:{class:"ph-x-bold"}});c.appendChild(s);const d=p({tagName:"div",attributes:{draggable:"false",class:"deck-card-image-wrapper"}}),u=p({tagName:"img",attributes:{src:t,draggable:"false"}});d.appendChild(u);const m=p({tagName:"div",attributes:{class:"deck-card-counter"}});return m.innerText=String(e),i.appendChild(c),i.appendChild(d),i.appendChild(m),i},xe=e=>{const r=document.querySelector("#deck-container");e.forEach(t=>{var o;const n=Ae(t);(o=r==null?void 0:r.appendChild)==null||o.call(r,n)})},_e=(e,r)=>{Q(e,r);const t=L(e),n=L(r),o=U(),{id:a}=t,{id:i}=n,c=Array.from(o),s=c.findIndex(([h])=>h===a),d=c.findIndex(([h])=>h===i),u=c[s];c[s]=c[d],c[d]=u;const m=new Map(c);Oe(m)},Me=()=>{const e=document.querySelectorAll(".deck-card"),r=document.querySelector(".remove-card-zone");if(r){const t=f(r,"dragover"),n=f(r,"dragleave"),o=f(r,"drop");t.pipe(S(a=>{a.preventDefault()})).subscribe(()=>{r.classList.add("on-dragover-remove-card-zone")}),n.pipe(S(a=>{a.preventDefault()})).subscribe(()=>{r.classList.remove("on-dragover-remove-card-zone")}),o.pipe(S(a=>{a.preventDefault()})).subscribe(()=>{const a=document.querySelector(".is-dragging");if(!a)return;const{id:i}=a.dataset;i&&(F(i),r.classList.remove("on-dragover-remove-card-zone"))})}e.forEach(t=>{const n=f(t,"dragstart"),o=f(t,"drop"),a=f(t,"dragover"),i=f(t,"dragend");a.pipe(S(c=>{c.preventDefault()})).subscribe(),n.pipe(k(c=>c.target)).subscribe(c=>{c.classList.add("is-dragging"),r==null||r.classList.add("show-remove-card-zone")}),i.pipe(k(c=>c.target)).subscribe(c=>{c.classList.remove("is-dragging"),r==null||r.classList.remove("show-remove-card-zone")}),o.pipe(S(c=>{c.preventDefault()}),k(c=>c.target)).subscribe(c=>{const s=document.querySelector(".is-dragging");s!==null&&_e(c,s)})})};De.subscribe(()=>{const e=U();xe(e),Me()});export{z as T,ae as a,ee as b,C as c,R as d,me as e,Z as f,re as g,oe as h,E as i,ce as j,te as k,k as l,q as m,f as n,O as o,Ne as p,se as r,S as t};
